---
title: 命令行基础
date: 208-01-08 09:00:00
tags:
 - 计算机网络
---

>计算机与网络设备要相互通信，双方就必须基于相同的方法。比如，如何探测到通信目标、由哪一边先发起通信、使用哪种语言进行通信、怎样结束通信等规则都需要事先确定。不同的硬件、操作系统之间的通信，所有的这一切都需要一种规则。而我们就把这种规则称为协议(Protocol)。  

# 1. TCP/IP 协议族
* TCP/IP 是互联网相关的各类协议族的总称也有说法 认为，TCP/IP 是指 TCP 和 IP 这两种协议。还有一种说法认为，TCP/ IP 是在 IP 协议的通信过程中，使用到的协议族的统称。
![](http://ww1.sinaimg.cn/large/9f4be9b7ly1fn909ehzhqj20ml0b23zo.jpg)

# 2. TCP/IP 的分层管理 
TCP/IP 协议族里重要的一点就是分层。TCP/IP 协议族按层次分别分为以下 4 层：
- 应用层
    > 应用层决定了向用户提供应用服务时通信的活动。  
    包括：FTP、DNS、HTTP
- 传输层
    > 传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。    
    包括：TCP、UDP
- 网络层
    > 网络层用来处理在网络上流动的数据包。数据包是网络传输的最小数 据单位。该层规定了通过怎样的路径（所谓的传输路线）到达对方计算机，并把数据包传送给对方。        
    与对方计算机之间通过多台计算机或网络设备进行传输时，网络层所起的作用就是在众多的选项内选择一条传输路线。    
    包括：IP、
- 数据链路层
    > 用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在 链路层的作用范围之内。

# 3. TCP/IP 通信传输流
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn90nekhk9j20lw0gzq3t.jpg)

&emsp;&emsp;用 HTTP 举例来说明：
> - 首先作为发送端的客户端在应用层 （HTTP 协议）发出一个想看某个 Web 页面的 HTTP 请求。 
> - 接着，为了传输方便，在传输层（TCP协议）把从应用层处收到的数据（HTTP请求报文）进行分割，并在各个报文上打上标记序号及端口号后转发给网络层。
> - 在网络层（IP 协议），增加作为通信目的地的 MAC 地址后转发给链路层。 这样一来，发往网络的通信请求就准备齐全了。
> - 接收端的服务器在链路层接收到数据，按序往上层发送，一直到应用层。当传输到应用层，才能算真正接收到由客户端发送过来的 HTTP 请求。 发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每经过一层 时会把对应的首部消去。 

![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn911rcesrj20hq0g2wfx.jpg)

# 4. 与 HTTP 关系密切的协议 : IP、TCP 和 DNS
## 4.1 负责传输的 IP 协议
&emsp;&emsp;按层次分，IP（Internet Protocol）网际协议位于网络层。Internet Protocol 这个名称可能听起来有点夸张，但事实正是如此，因为几乎所有使用网络的系统都会用到 IP 协议。TCP/IP协议族中的IP指的就是网际协议，协议名称中占据了一半位置，其重要性可见一斑。可能 有人会把“IP”和“IP 地址”搞混，“IP”是协议的名称。    
&emsp;&emsp;IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址（Media Access Control Address）。
IP 地址指明了节点被分配到的地址，MAC 地址是指网卡所属的固定地址。IP 地址可以和 MAC 地址进行配对。IP 地址可变，但 MAC 地址基本不会。  
&emsp;&emsp;IP 间的通信依赖MAC地址。在网络上，通信的双方在同一局域网（LAN）内的情况是很少的，通常是经过多台计算机和网络设备中转才能连接到对方。而在进行中转时，会利用下一站中转设备的 MAC地址来搜索下一个中转目标。这时，会采用 ARP 协议（Address Resolution Protocol）。ARP是一种用以解析地址的协议，根据通信方的 IP 地址就可以反查出对应的 MAC 地址。  
&emsp;&emsp;在到达通信目标前的中转过程中，那些计算机和路由器等网设备只能获悉很粗略的传输路线。这种机制称为路由选择（routing），有点像快递公司的送货过程。想要寄快递的人，只要将自己的货物送到集散中心，就可以知道快递公司是否肯收件发货，该快递公司的集散中心检查货物的送达地址，明确下站该送往哪个区域的集散中心。接着，那个区域的集散中心自会判断是否能送到对方的家中。    
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn91gr85zcj20hu0fygng.jpg)
## 4.2 确保可靠性的 TCP 协议 
&emsp;&emsp;按层次分，TCP 位于传输层，提供可靠的字节流服务。    
&emsp;&emsp;**字节流服务**：为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理。    
&emsp;&emsp;**可靠**：TCP 协议能够确认数据最终是否送达到对方。
为了准确无误地将数据送达目标处，TCP 协议建立连接时采用**三次握手** （three-way handshaking）策略。发送端首先发送一个带 SYN 标志的数据包给对方。接收端收到后， 回传一个带有 SYN/ACK 标志的数据包以示传达确认信息。最后，发送端再回传一个带 ACK 标志的数据包，完成三次握手，客户端与服务器开始传送数据。  
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn9202w8hjj20gu09smy8.jpg)   
&emsp;&emsp;数据传输完成后，采用**四次挥手**策略关闭TCP连接。第一步，当主机A的应用程序通知TCP数据已经发送完毕时，TCP向主机B发送一个带有FIN附加标记的报文段（FIN表示英文finish）。第二步，主机B收到这个FIN报文段之后，并不立即用FIN报文段回复主机A，而是先向主机A发送一个确认序号ACK，同时通知自己相应的应用程序：对方要求关闭连接（先发送ACK的目的是为了防止在这段时间内，对方重传FIN报文段）。第三步，主机B的应用程序告诉TCP：我要彻底的关闭连接，TCP向主机A送一个FIN报文段。第四步，主机A收到这个FIN报文段后，向主机B发送一个ACK表示连接彻底释放。
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fndyec0z8sj20j50k8dj6.jpg)   

## 4.3 负责域名解析的 DNS 服务
&emsp;&emsp;DNS（Domain Name System）服务是和 HTTP 协议一样位于应用层的协议。它提供域名到 IP 地址之间的解析服务。DNS 协议提供通过域名查找 IP 地址，或逆向从 IP 地址反查域名的服务。
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn928lf7mvj20l80ejacc.jpg)

# 5. 各种协议与 HTTP 协议的关系
![](http://ww1.sinaimg.cn/large/9f4be9b7gy1fn92gh1d59j20n60vnduc.jpg)